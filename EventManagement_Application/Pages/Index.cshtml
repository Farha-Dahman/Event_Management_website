@page
@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<section id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
    <!-- Carousel Indicators -->
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>

    <!-- Carousel Items -->
    <div class="carousel-inner">
        <!-- First Slide -->
        <div class="carousel-item active">
            <div class="d-flex align-items-center bg-image first-slide justify-content-center text-center text-white bg-dark" style="height: 80vh;">
                <div>
                    <h1 class="display-3 fw-bold">Welcome to Eventify</h1>
                    <p class="lead">Discover the hottest events near you!</p>
                    <a href="./Identity/Account/Register" class="btn btn-outline-light bg-btn btn-lg">Get started for free</a>
                    <a href="#" class="btn btn-outline-light btn-lg">View Latest Event</a>
                </div>
            </div>
        </div>

        <!-- Second Slide -->
        <div class="carousel-item">
            <div class="d-flex align-items-center second-slide justify-content-center text-center text-white bg-primary" style="height: 80vh;">
                <div>
                    <h1 class="display-3 fw-bold">Join, Explore & Connect</h1>
                    <p class="lead">Stay updated and never miss out on amazing events.</p>
                </div>
            </div>
        </div>

        <!-- Third Slide -->
        <div class="carousel-item">
            <div class="d-flex align-items-center third-slide justify-content-center text-center text-white bg-secondary" style="height: 80vh;">
                <div>
                    <h1 class="display-3 fw-bold">Your Next Event Awaits</h1>
                    <p class="lead">Create, share, and manage events with ease!</p>
                    <a href="./Events" class="btn btn-outline-light btn-lg">Explore Events</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- About Section -->
<div class="container text-center my-3 py-5 about-section">
    <h2 class="mb-4 section-title">WHY EVENTIFY?</h2>
    <p class="lead">
        Eventify is your one-stop platform to explore, organize, and manage events seamlessly.
        Stay connected and experience unforgettable moments!
    </p>

    <div class="row mt-5 pt-3">
        <div class="col-md-4">
            <div class="feature-card p-4">
                <i class="fa-solid fa-calendar-check feature-icon mb-3 p-3 rounded-circle"></i>
                <h5>Easy Event Management</h5>
                <p>Create, edit, and track events with a few clicks.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="feature-card p-4">
                <i class="fa-solid fa-ticket-alt feature-icon mb-3 p-3 rounded-circle"></i>
                <h5>Hassle-Free Ticketing</h5>
                <p>Sell tickets online and manage check-ins effortlessly.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="feature-card p-4">
                <i class="fa-solid fa-users feature-icon mb-3 p-3 rounded-circle"></i>
                <h5>Connect With Attendees</h5>
                <p>Engage with participants and grow your network.</p>
            </div>
        </div>
    </div>
</div>

<!-- Upcoming Events Section -->
<div id="upcomingEventCarousel" class="latest-events-section carousel slide py-5 mb-2" data-bs-ride="carousel">
    <div class="container">
        <div class="d-flex justify-content-center align-items-center mb-4">
            <div class="text-center">
                <h2 class="section-title">Upcoming Events</h2>
                <p class="section-subtitle">Don’t miss out on these exciting upcoming events!</p>
            </div>
        </div>
        <a href="./Attendee/ViewEvents" class="clr-text align-items-end justify-content-end d-flex text-decoration-none fw-bold py-1">
            Show More <i class="fa-solid fa-arrow-right px-3 mb-1"></i>
        </a>
    </div>

    <!-- Carousel Inner -->
    <div class="carousel-inner">
        @{
            var chunkCount = 4; // Show 4 events per slide
            var upcomingEvents = Model.UpcomingEvents
                                      .Where(e => e.EventDate > DateTime.Now) // Only future events
                                      .OrderBy(e => e.EventDate) // Earliest first
                                      .Take(8) // Limit to 8 upcoming events
                                      .Select((x, i) => new { x, i })
                                      .GroupBy(x => x.i / chunkCount)
                                      .Select(g => g.Select(v => v.x).ToList())
                                      .ToList();
        }

        @for (int i = 0; i < upcomingEvents.Count; i++)
        {
            <div class="carousel-item @(i == 0 ? "active" : "")">
                <div class="container">
                    <div class="row g-3">
                        @foreach (var eventItem in upcomingEvents[i])
                        {
                            <div class="col-md-3 p-2">
                                <div class="card border-0">
                                    <img src="@(eventItem.EventImage != null ? "data:image/jpeg;base64," + Convert.ToBase64String(eventItem.EventImage) : "/images/default-image.jpg")"
                                         class="card-img-top"
                                         alt="Event Image">
                                    <div class="card-body text-start">
                                        <h5 class="card-title fw-bold">@eventItem.Title</h5>
                                        <p class="text-muted small">@eventItem.Category</p>
                                        <p><i class="fa-solid fa-calendar"></i> @eventItem.EventDate.ToString("yyyy-MM-dd HH:mm")</p>
                                        <p><i class="fa-solid fa-map-marker-alt"></i> @eventItem.Location</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Carousel Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#upcomingEventCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#upcomingEventCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<!-- Features Section -->
<section class="features-section py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h2 class="fw-bold text-dark">Powerful Event Management</h2>
                <p class="text-muted pb-5">Manage, discover, and sell tickets for events seamlessly.</p>
                <div class="d-flex align-items-start mb-4">
                    <i class="fa-regular fa-calendar feature-icon p-3 rounded-circle me-4"></i>
                    <div>
                        <h5 class="fw-bold">Event Management</h5>
                        <p class="text-muted">Create, manage, and track events with powerful tools.</p>
                    </div>
                </div>
                <div class="d-flex align-items-start mb-4">
                    <i class="fa-solid fa-list-check feature-icon p-3 rounded-circle me-4"></i>
                    <div>
                        <h5 class="fw-bold">Event Discovery</h5>
                        <p class="text-muted">Find exciting events based on your interests.</p>
                    </div>
                </div>
                <div class="d-flex align-items-start">
                    <i class="fa-solid fa-ticket feature-icon p-3 rounded-circle me-4"></i>
                    <div>
                        <h5 class="fw-bold">Seamless Ticketing</h5>
                        <p class="text-muted">E-tickets with QR codes for easy access.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 text-center">
                <img src="~/images/management-office.svg" alt="Event Management Image" class="img-fluid rounded shadow">
            </div>
        </div>
    </div>
</section>

<!-- Companies Section -->
<div class="container my-5 py-5">
    <section class="row justify-content-center align-items-center text-center g-4">
        <div class="col-6 col-md-4 col-lg-2">
            <img src="~/images/Google.svg" alt="Google" class="img-fluid brand-logo">
        </div>
        <div class="col-6 col-md-4 col-lg-2">
            <img src="~/images/Microsoft.svg" alt="Microsoft" class="img-fluid brand-logo">
        </div>
        <div class="col-6 col-md-4 col-lg-2">
            <img src="~/images/Spotify.svg" alt="Spotify" class="img-fluid brand-logo">
        </div>
        <div class="col-6 col-md-4 col-lg-2">
            <img src="~/images/Mailchimp.svg" alt="Mailchimp" class="img-fluid brand-logo">
        </div>
        <div class="col-6 col-md-4 col-lg-2">
            <img src="~/images/Airbnb.svg" alt="Airbnb" class="img-fluid brand-logo">
        </div>
        <div class="col-6 col-md-4 col-lg-2">
            <img src="~/images/uber.svg" alt="uber" class="img-fluid brand-logo">
        </div>
    </section>
</div>

<!-- Contact Section -->
<section class="contact-section my-5">
    <div class="container">
        <div class="row align-items-center">
            <!-- Left Side: Image -->
            <div class="col-md-6 col-sm-12">
                <img src="~/images/Messages-amico.svg" alt="Contact Us" class="img-fluid w-75">
            </div>

            <!-- Right Side: Contact Form -->
            <div class="col-md-6">
                <h2>Contact Us</h2>
                <form action="send_email.php" method="POST">
                    <div class="mb-3">
                        <label for="subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="subject" name="subject" required>
                    </div>
                    <div class="mb-3">
                        <label for="message" class="form-label">Message</label>
                        <textarea class="form-control" id="message" name="message" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Reating System Section -->
@* <section class="feedback-section py-5"> *@
@*     <div class="container"> *@
@*         <h2 class="text-center fw-bold mb-4">Event Feedback & Ratings</h2> *@
@*         <p class="text-center text-muted">See what attendees are saying about our events.</p> *@

@*         <div class="row justify-content-center"> *@
@*             @foreach (var feedback in Model.RecentFeedbacks) *@
@*             { *@
@*                 <div class="col-md-4"> *@
@*                     <div class="card feedback-card shadow-sm p-3"> *@
@*                         <div class="d-flex align-items-center"> *@
@*                             <img src="@(feedback.UserAvatar ?? "/images/default-avatar.jpg")" class="rounded-circle me-3" width="50" height="50" alt="User Avatar"> *@
@*                             <div> *@
@*                                 <h5 class="fw-bold m-0">@feedback.UserName</h5> *@
@*                                 <small class="text-muted">@feedback.SubmittedAt.ToString("yyyy-MM-dd")</small> *@
@*                             </div> *@
@*                         </div> *@

@*                         <div class="mt-2"> *@
@*                             <!-- Star Rating --> *@
@*                             <div class="stars"> *@
@*                                 @for (int i = 1; i <= 5; i++) *@
@*                                 { *@
@*                                     <i class="fa-solid fa-star @(i <= feedback.Rating ? "text-warning" : "text-muted")"></i> *@
@*                                 } *@
@*                             </div> *@

@*                             <p class="mt-2 text-muted">"@feedback.Comment"</p> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             } *@
@*         </div> *@
@*     </div> *@
@* </section> *@



@* <script> *@
@*     document.getElementById("requestAccessButton").addEventListener("click", function () { *@
@*         var confirmModal = new bootstrap.Modal(document.getElementById("confirmRequestModal")); *@
@*         confirmModal.show(); *@
@*     }); *@
@*     function isInView(element) { *@
@*         const rect = element.getBoundingClientRect(); *@
@*         return rect.top >= 0 && rect.bottom <= window.innerHeight; *@
@*     } *@

@*     // Trigger the transition when the section is in view *@
@*     document.addEventListener('scroll', () => { *@
@*         const section = document.querySelector('.features-section'); *@
@*         if (isInView(section)) { *@
@*             section.classList.add('show'); *@
@*         } *@
@*     }); *@
@* </script> *@


<!-- Latest Events Section -->
<div id="eventCarousel" class="latest-events-section carousel slide py-5" data-bs-ride="carousel">
    <div class="container">
        <div class="d-flex justify-content-center align-items-center mb-4">
            <div class="text-center">
                <h2 class="section-title">Latest Events</h2>
                <p class="section-subtitle">Stay updated with the newest events happening around you!</p>
            </div>
        </div>
        <a href="./Attendee/ViewEvents" class="clr-text align-items-end justify-content-end d-flex text-decoration-none fw-bold py-1">
            Show More <i class="fa-solid fa-arrow-right px-3 mb-1"></i>
        </a>
    </div>

    <!-- Carousel Inner -->
    <div class="carousel-inner">
        @{
            var chunkSize = 4; // Show 4 events per slide
            var eventChunks = Model.LatestEvents.OrderByDescending(e => e.EventDate)
            .Take(8) // Fetch 8 latest events
            .Select((x, i) => new { x, i })
            .GroupBy(x => x.i / chunkSize)
            .Select(g => g.Select(v => v.x).ToList())
            .ToList();
        }

        @for (int i = 0; i < eventChunks.Count; i++)
        {
            <div class="carousel-item @(i == 0 ? "active" : "")">
                <div class="container">
                    <div class="row g-3">
                        @foreach (var eventItem in eventChunks[i])
                        {
                            <div class="col-md-3 p-2">
                                <div class="card border-0">
                                    <img src="@(eventItem.EventImage != null ? "data:image/jpeg;base64," + Convert.ToBase64String(eventItem.EventImage) : "/images/default-image.jpg")"
                                         class="card-img-top"
                                         alt="Event Image">
                                    <div class="card-body text-start">
                                        <h5 class="card-title fw-bold">@eventItem.Title</h5>
                                        <p class="text-muted small">@eventItem.Category</p>
                                        <p><i class="fa-solid fa-calendar"></i> @eventItem.EventDate.ToString("yyyy-MM-dd HH:mm")</p>
                                        <p><i class="fa-solid fa-map-marker-alt"></i> @eventItem.Location</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Carousel Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#eventCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#eventCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>


@if (SignInManager.IsSignedIn(User))
{
    <section class="become-organizer-section text-center pb-5">
        <div class="container">
            <hr class="w-50 d-inline-grid"/>
            <h2 class="fw-bold py-3 clr-text">Become an Event Organizer</h2>
            <p class="text-muted">
                Want to host your own events? Request to become an organizer and start creating events today!
            </p>
            <button type="button" class="btn bg-primary-color rounded-1 text-white fw-bold btn-lg" id="requestAccessButton">
                Request Access
            </button>
        </div>
    </section>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmRequestModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to request access as an event organizer?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form method="post" id="requestForm">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn bg-primary-color text-white">Yes, Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}
