@page "{eventId:int}"
@model EventManagement_Application.Pages.Organizer.Tickets.CreateModel
@{
    ViewData["Title"] = "Create Tickets";
}

<h1>
    Create Tickets for Your Event @* @Model.Event.Title *@
</h1>

<form method="post">
    <!-- Hidden input to bind the EventId to the Ticket -->
    <input type="hidden" asp-for="Ticket.EventId" />

    <div class="ticket-form">
        <h3>Ticket</h3>
        <div class="form-group">
            <label asp-for="Ticket.Price">Ticket Price</label>
            <input asp-for="Ticket.Price" class="form-control price-input" type="number" step="0.01" min="0" value="@Model.Ticket.Price" oninput="updateTicketType()" />
            <span asp-validation-for="Ticket.Price" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Ticket.TicketType">Ticket Type</label>
            <input asp-for="Ticket.TicketType" class="form-control ticket-type-input" readonly="readonly" value="@Model.Ticket.TicketType" />
            <span asp-validation-for="Ticket.TicketType" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Ticket.Quantity">Quantity</label>
            <input asp-for="Ticket.Quantity" class="form-control quantity-input" type="number" min="1" placeholder="Enter Quantity" required value="@Model.Ticket.Quantity" />
            <span asp-validation-for="Ticket.Quantity" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Ticket.AvailableTickets">Available Seats</label>
            <input asp-for="Ticket.AvailableTickets" class="form-control quantity-input" type="number" min="1" placeholder="Enter Available Seats" required value="@Model.Ticket.AvailableTickets" />
            <span asp-validation-for="Ticket.AvailableTickets" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Ticket.OpenDate"></label>
            <input asp-for="Ticket.OpenDate" class="form-control" type="datetime-local"
                   value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")"
                   min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" />
            <span asp-validation-for="Ticket.OpenDate" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Ticket.CloseDate"></label>
            <input asp-for="Ticket.CloseDate" class="form-control" type="datetime-local"
                   value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")"
                   min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" />
            <span asp-validation-for="Ticket.CloseDate" class="text-danger"></span>
        </div>
    </div>
    <div class="py-2">
        <button type="submit" class="btn btn-success">Create Ticket</button>
        <a asp-page="../Events/Details" asp-route-id="@Model.Event.Id" class="btn btn-secondary">Back to Event</a>
    </div>
</form>

<script>
    // Update ticket type based on the price value
    function updateTicketType() {
        let priceInput = document.querySelector('.price-input');
        let ticketTypeInput = document.querySelector('.ticket-type-input');

        if (parseFloat(priceInput.value) === 0) {
            ticketTypeInput.value = "Free";
            ticketTypeInput.setAttribute("readonly", "readonly");
        } else {
            ticketTypeInput.removeAttribute("readonly");
            ticketTypeInput.value = "";
            ticketTypeInput.placeholder = "Enter Your Ticket Type...";
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        updateTicketType();
    });
</script>
